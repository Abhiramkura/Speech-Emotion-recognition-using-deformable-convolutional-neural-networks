<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Speech Emotion Recognition</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap"
      rel="stylesheet"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <div class="container">
      <div class="card">
        <h1>üéôÔ∏è Speech Emotion Recognition</h1>

        <form
          id="audioForm"
          action="/"
          method="POST"
          enctype="multipart/form-data"
        >
          <label class="custom-file-upload">
            <input
              type="file"
              name="audio"
              id="audioInput"
              accept=".wav"
              onchange="previewAudio(event)"
            />
            Upload Audio üéµ
          </label>
          <button type="submit">üîç Predict Emotion</button>
        </form>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %} {% if
        messages %}
        <div class="flash-container">
          {% for category, message in messages %}
          <div class="flash-message {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
        {% endif %} {% endwith %}

        <!-- Preview Before Predicting -->
        <div id="previewContainer" class="audio-preview" style="display: none">
          <h3>Preview Uploaded Audio:</h3>
          <audio id="audioPlayer" controls>
            <source id="audioSource" src="" type="audio/wav" />
            Your browser does not support the audio element.
          </audio>
        </div>

        {% if prediction %}
        <div class="result">
          <h2 class="emotion-detect">üß† Emotion Detected:</h2>
          <p class="emotion">{{ prediction }}</p>
          <h3 class="uploaded">Uploaded Audio: {{ audio_name }}</h3>
          <audio controls>
            <source
              src="{{ url_for('uploaded_file', filename=filename) }}"
              type="audio/wav"
            />
            Your browser does not support the audio element.
          </audio>
        </div>
        {% endif %}
      </div>
    </div>

    <script>
      // Audio preview before prediction
      function previewAudio(event) {
        const file = event.target.files[0];
        if (file) {
          const audioURL = URL.createObjectURL(file);
          document.getElementById("audioSource").src = audioURL;
          document.getElementById("audioPlayer").load();
          document.getElementById("previewContainer").style.display = "block";
        }
      }

      // Prevent submission without audio file
      document
        .getElementById("audioForm")
        .addEventListener("submit", function (e) {
          const fileInput = document.getElementById("audioInput");
          if (!fileInput.files.length) {
            e.preventDefault();
            alert("Please upload a .wav file before predicting.");
          }
        });
    </script>
  </body>
</html>
